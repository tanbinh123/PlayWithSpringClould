### 驱动大型网站技术发展的主要力量是网站的业务发展

> 是业务成就了技术，是事业成就了人，而不是相反。

### 企图用技术解决所有问题

> 技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决。

### 模式

> 关于什么是模式，这个来自建筑学的词汇是这样定义的：“每一个模式描述了一个在我们周围不断重复发生的问题及该问题的解决方案的核心。这样，你就能一次又一次地使用该方案而不必要重复工作”。

我们的现实生活中充斥着几乎千篇一律的人生架构模式：读重点学校，选热门专业，进稳定高收入的政府部门和企业，找门当户对的配偶，生一个听话的孩子继续这个模式......可是，人生不同于软件，精彩的人生绝不会来自复制。

### 软件架构

> 有关软件整体结构与组件的抽象描述，用于指导大型软件系统各个方面的设计

一般来说，除了当前的系统功能需求外，软件架构还需要关注**性能**、**可用性**、**伸缩性**、**扩展性**和**安全性**这 5 个架构要素。

高可用设计的目标是在服务器宕机的时候，服务或者应用依然可用。

### 性能

网站性能优化第一定律：优先使用缓存优化性能

> 网站数据的访问也遵循幂律曲线（二八定律，川普说的一九定律），即 80% 的访问落在 20% 的数据上，将这 20% 的数据缓存起来，可以很好的改善系统性能。

缓存雪崩：当缓存服务崩溃时，数据库会因为完全不能承受如此大的压力而宕机，进而导致整个网站不可用。
实践中，有的网站通过缓存热备（镜像）手段提高缓存可用性：当某台缓存服务器挂掉的时候，将缓存访问切换到热备服务器上，这种设计违背了缓存的初衷，缓存根本不应该被当做一个可靠的数据源来使用。

通过分布式缓存服务器集群，将缓存数据分布到多台缓存服务器上可一定程度改善缓存的可用性。当一台服务器挂掉的时候，只有部分缓存数据丢失，重新去数据库加载这部分数据不会对数据库产生很大影响。

缓存预热（warm up）：对于一些元数据如城市地名列表、类目信息，可以在系统启动时加载数据库中全部数据到缓存预热。

缓存穿透：如果因为业务不恰当、或者恶意攻击持续高并发地请求某个不存在的数据，由于缓存没有保存该数据，所有的请求都会落到数据库上。一个简单的对策是将不存在的数据也缓存起来（其 value 值为 null）。

### 集群的 session 管理

1. session 复制：让集群中的机器实时同步 session 信息

2. session 绑定：利用负载均衡的源地址 Hash 算法实现，将来源于同一 IP 的请求分发到同一台机器上（也可以根据 Cookie 信息将同一个用户的信息总是分发到同一台机器上）

3. 利用 Cookie 记录 session

4. session 服务器


### 高可用的服务

1. 分级管理

2. 超时设置

3. 异步调用

4. 服务降级

5. 幂等性设计

### 高可用的数据

**数据持久性**、**数据可访问性**、**数据一致性**


### CAP 原理

CAP 原理认为，一个提供数据服务的存储系统无法同时满足数据一致性（Consistency）、数据可用性（Availibility）、分区耐受性（Patition Tolerance）这三个条件

**数据一致性**
- **数据强一致**：各个副本的数据在物理存储中总是一致的；写入操作的响应也总是一致的，准确的。
- **数据用户一致**：各个副本的数据可能是不一致的；但在终端访问时，通过纠错和校验机制，可以确定一个一致且正确的数据返回给用户。
- **数据最终一致**：各个副本的数据可能是不一致的

### 常用系统操作响应时间表

- 打开一个网站 -> 几秒
- 在数据库中查询一条记录（有索引) -> 十几毫秒
- 机械硬盘一次寻址定位 -> 4毫秒
- 从机械硬盘顺序读取 1mb 数据 -> 2毫秒
- 从 SSD 硬盘顺序读取 1mb 数据 -> 0.3毫秒
- 从远程分布式缓存 Redis 读取一个数据 -> 0.5毫秒
- 从内存读取 1mb 数据 -> 十几微秒
- Java 程序本地方法调用 -> 几微秒
- 网络传输 2kb 数据 -> 1微秒

### 性能测试方法

- 性能测试
- 负载测试
- 压力测试
- 稳定性测试

### 网站可用性的度量

网站不可用也被称作网站故障，业界通常用多少个 9 来衡量网站的可用性，如 QQ 的四个九，即 QQ 服务 99.99% 可用。
这意味着 QQ 服务要保证其所有运行时间中，只有 0.01% 的时间不可用，也就是一年中最多 53 分钟不可用。五个九是极高可用性，其年度不可用时间小于 5 分钟。


